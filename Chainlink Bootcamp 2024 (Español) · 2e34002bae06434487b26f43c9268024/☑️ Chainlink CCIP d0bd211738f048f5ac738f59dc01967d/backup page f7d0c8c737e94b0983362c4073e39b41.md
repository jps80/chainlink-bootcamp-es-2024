# backup page

[https://www.youtube.com/watch?v=y_iOxra1oLc](https://www.youtube.com/watch?v=y_iOxra1oLc)

Contrato: CrossChainPriceNFT

0x62d09d075c31e6eeddd9ab3e5e74834e5aef8ed9

[https://testnets.opensea.io/es/collection/crosschain-price-341](https://testnets.opensea.io/es/collection/crosschain-price-341) 

Contrato:  CrossDestinationMinter

[0xcdcb47546561f3bea7cd6913a9d628dad5177c8e](https://sepolia.etherscan.io/address/0xcdcb47546561f3bea7cd6913a9d628dad5177c8e)

Contrato: (Fuji) CrossSourceMinter

0xcdc32dc6b7c4022ac2bbbf2cad500e6d0469ef77

IdTx

[https://ccip.chain.link/msg/0x304ab1910bb3d5480a8f0b2df0036d0b0fe43790e5fc6c36a4b550ff108e0480](https://ccip.chain.link/msg/0x304ab1910bb3d5480a8f0b2df0036d0b0fe43790e5fc6c36a4b550ff108e0480)

Contrato (Mumbai) CrossSourceMinterMumbai

0x8a0b63a36b2d4ab4fdade5feba89c19d5aa594aa

idTx:

[0x56ccd072bc3331c213dee9e5a436233f307c178a161a080fc25c1acc8130fd8e](https://ccip.chain.link/msg/0x37137d817c43415011aa27b65a3ef8b3dc6182d577749c69e8685b1657af45fa)

Chainlink Bootcamp by Solange Gueiros

Clase 07

Pad

[https://pad.riseup.net/p/cl-es-07](https://pad.riseup.net/p/cl-es-07)

Youtube Link de la Clase de hoy

[https://www.youtube.com/watch?v=y_iOxra1oLc](https://www.youtube.com/watch?v=y_iOxra1oLc)

Todas las sesiones en EspaÃ±ol para

[https://lu.ma/fkr85zi7](https://lu.ma/fkr85zi7)

[https://github.com/solangegueiros/chainlink-bootcamp-2024](https://github.com/solangegueiros/chainlink-bootcamp-2024)

Slides

[https://docs.google.com/presentation/d/e/2PACX-1vSWSZfMuNAjQrRFEsUXZad1j-1POA_XlGpsXfy0uQmwAhFjBxyysJ8Y8xKL18FGu77NXFfovotT90F2/pub?start=false&loop=false&delayms=3000](https://docs.google.com/presentation/d/e/2PACX-1vSWSZfMuNAjQrRFEsUXZad1j-1POA_XlGpsXfy0uQmwAhFjBxyysJ8Y8xKL18FGu77NXFfovotT90F2/pub?start=false&loop=false&delayms=3000)

Tareas Form

[https://forms.gle/N8eAXAaSE5WzPd1t7](https://forms.gle/N8eAXAaSE5WzPd1t7)

Twitter

[https://twitter.com/chainlinkesp](https://twitter.com/chainlinkesp)

[https://twitter.com/javosalomon](https://twitter.com/javosalomon)

Chainlink Community Advocate

[https://chain.link/community/advocates](https://chain.link/community/advocates)

Chainlink Developer Expert

[https://chain.link/developers/experts](https://chain.link/developers/experts)

[https://chainlist.org/](https://chainlist.org/)

Metamask

Sepolia

[https://workshop-faucet.vercel.app/faucets/sepolia](https://workshop-faucet.vercel.app/faucets/sepolia)

cllworkshop0101

[https://remix.ethereum.org/](https://remix.ethereum.org/)

Icon 5 - DEPLOY & RUN TRANSACTIONS

ENVIRONMENT

Injected provider - Metamask

Sepolia

Criar

CrossChainPriceNFT.sol

// Inicio

// SPDX-License-Identifier: MIT

pragmaÂ solidity 0.8.19;

// Deploy this contract on Sepolia

// Importing OpenZeppelin contracts

import "@openzeppelin/contracts@4.6.0/token/ERC721/extensions/ERC721URIStorage.sol";

import "@openzeppelin/contracts@4.6.0/utils/Counters.sol";

import "@openzeppelin/contracts@4.6.0/utils/Base64.sol";

// Importing Chainlink contracts

import "@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol";

contract CrossChainPriceNFT is ERC721, ERC721URIStorage {

using Counters for Counters.Counter;

using Strings for uint256;

Counters.Counter public tokenIdCounter;

// Create price feed

AggregatorV3Interface internal priceFeed;

uint256 public lastPrice = 0;

string priceIndicatorUp = unicode"ðŸ˜€";

string priceIndicatorDown = unicode"ðŸ˜”";

string priceIndicatorFlat = unicode"ðŸ˜‘";

string public priceIndicator;

struct ChainStruct {

uint64 code;

string name;

string color;

}

mapping (uint256 => ChainStruct) chain;

//[https://docs.chain.link/ccip/supported-networks/testnet](https://docs.chain.link/ccip/supported-networks/testnet)

constructor() ERC721("CrossChain Price", "CCPrice") {

chain[0] = ChainStruct ({

code: 16015286601757825753,

name: "Sepolia",

color: "#0000ff" //blue

});

chain[1] = ChainStruct ({

code: 14767482510784806043,

name: "Fuji",

color: "#ff0000" //red

});

chain[2] = ChainStruct ({

code: 12532609583862916517,

name: "Mumbai",

color: "#4b006e" //purple

});

//Â [https://docs.chain.link/data-feeds/price-feeds/addresses](https://docs.chain.link/data-feeds/price-feeds/addresses)

priceFeed = AggregatorV3Interface(

// Sepolia BTC/USD

0x1b44F3514812d835EB1BDB0acB33d3fA3351Ee43

);

// Mint an NFT

mint(msg.sender);

}

function mint(address to) public {

// Mint from Sepolia network = chain[0]

mintFrom(to, 0);

}

function mintFrom(address to, uint256 sourceId) public {

// sourceId 0 Sepolia, 1 Fuji, 2 Mumbai

uint256 tokenId = tokenIdCounter.current();

_safeMint(to, tokenId);

updateMetaData(tokenId, sourceId);

tokenIdCounter.increment();

}

// Update MetaData

function updateMetaData(uint256 tokenId, uint256 sourceId) public {

// Create the SVG string

string memory finalSVG = buildSVG(sourceId);

// Base64 encode the SVG

string memory json = Base64.encode(

bytes(

string(

abi.encodePacked(

'{"name": "Cross-chain Price SVG",',

'"description": "SVG NFTs in different chains",',

'"image": "data:image/svg+xml;base64,',

Base64.encode(bytes(finalSVG)), '",',

'"attributes": [',

'{"trait_type": "source",',

'"value": "', chain[sourceId].name ,'"},',

'{"trait_type": "price",',

'"value": "', lastPrice.toString() ,'"}',

']}'

)

)

)

);

// Create token URI

string memory finalTokenURI = string(

abi.encodePacked("data:application/json;base64,", json)

);

// Set token URI

_setTokenURI(tokenId, finalTokenURI);

}

// Build the SVG string

function buildSVG(uint256 sourceId) internal returns (string memory) {

// Create SVG rectangle with random color

string memory headSVG = string(

abi.encodePacked(

"<svg xmlns='[http://www.w3.org/2000/svg](http://www.w3.org/2000/svg)' version='1.1' xmlns:xlink='[http://www.w3.org/1999/xlink](http://www.w3.org/1999/xlink)' xmlns:svgjs='[http://svgjs.com/svgjs](http://svgjs.com/svgjs)' width='500' height='500' preserveAspectRatio='none' viewBox='0 0 500 500'> <rect width='100%' height='100%' fill='",

chain[sourceId].color,

"' />"

)

);

// Update emoji based on price

string memory bodySVG = string(

abi.encodePacked(

"<text x='50%' y='50%' font-size='128' dominant-baseline='middle' text-anchor='middle'>",

comparePrice(),

"</text>"

)

);

// Close SVG

string memory tailSVG = "</svg>";

// Concatenate SVG strings

string memory _finalSVG = string(

abi.encodePacked(headSVG, bodySVG, tailSVG)

);

return _finalSVG;

}

// Compare new price to previous price

function comparePrice() public returns (string memory) {

uint256 currentPrice = getChainlinkDataFeedLatestAnswer();

if (currentPrice > lastPrice) {

priceIndicator = priceIndicatorUp;

} else if (currentPrice < lastPrice) {

priceIndicator = priceIndicatorDown;

} else {

priceIndicator = priceIndicatorFlat;

}

lastPrice = currentPrice;

return priceIndicator;

}

function getChainlinkDataFeedLatestAnswer() public view returns (uint256) {

(, int256 price, , , ) = priceFeed.latestRoundData();

return uint256(price);

}

function tokenURI(uint256 tokenId)

public view override(ERC721, ERC721URIStorage) returns (string memory)

{

return super.tokenURI(tokenId);

}

// The following function is an override required by Solidity.

function _burn(uint256 tokenId) internal override(ERC721, ERC721URIStorage)

{

super._burn(tokenId);

}

}

// Fin

Deploy

- ***********************

En Remix

CrossChainPriceNFT

Mint

Para su billetera Metamask

En Sepolia

Crea

CrossDestinationMinter.sol

// Inicio

// SPDX-License-Identifier: MIT

pragma solidity 0.8.19;

// Deploy this contract on Sepolia

import {CCIPReceiver} from "@chainlink/contracts-ccip/src/v0.8/ccip/applications/CCIPReceiver.sol";

import {Client} from "@chainlink/contracts-ccip/src/v0.8/ccip/libraries/Client.sol";

interface InftMinter {

function mintFrom(address account, uint256 sourceId) external;

}

/**

* THIS IS AN EXAMPLE CONTRACT THAT USES HARDCODED VALUES FOR CLARITY.

* THIS IS AN EXAMPLE CONTRACT THAT USES UN-AUDITED CODE.

* DO NOT USE THIS CODE IN PRODUCTION.

*/

contract CrossDestinationMinter is CCIPReceiver {

InftMinter public nft;

event MintCallSuccessfull();

//Â [https://docs.chain.link/ccip/supported-networks/testnet](https://docs.chain.link/ccip/supported-networks/testnet)

address routerSepolia = 0x0BF3dE8c5D3e8A2B34D2BEeB17ABfCeBaf363A59;

constructor(address nftAddress) CCIPReceiver(routerSepolia) {

nft = InftMinter(nftAddress);

}

function _ccipReceive(

Client.Any2EVMMessage memory message

) internal override {

(bool success, ) = address(nft).call(message.data);

require(success);

emit MintCallSuccessfull();

}

function testMint() external {

// Mint from Sepolia

nft.mintFrom(msg.sender, 0);

}

function testMessage() external {

// Mint from Sepolia

bytes memory message;

message = abi.encodeWithSignature("mintFrom(address,uint256)", msg.sender, 0);

(bool success, ) = address(nft).call(message);

require(success);

emit MintCallSuccessfull();

}

function updateNFT(address nftAddress) external {

nft = InftMinter(nftAddress);

}

}

// Fin

- ************************************

En el contracto CrossDestinationMinter,

ejecutar las funciones

testMint

testMessage

- ***********************************

Metamask

SELECIONE Avalanche FUJI

Para anadir Fuji en Metamask

[https://chainlist.org/chain/43113](https://chainlist.org/chain/43113)

[https://workshop-faucet.vercel.app/faucets/fuji](https://workshop-faucet.vercel.app/faucets/fuji)

[https://faucets.chain.link/fuji](https://faucets.chain.link/fuji)

No Remix

Crea

CrossSourceMinter.sol

// Inicio

// SPDX-License-Identifier: MIT

pragma solidity 0.8.19;

// Deploy this contract on Fuji

import {IRouterClient} from "@chainlink/contracts-ccip/src/v0.8/ccip/interfaces/IRouterClient.sol";

import {Client} from "@chainlink/contracts-ccip/src/v0.8/ccip/libraries/Client.sol";

import {LinkTokenInterface} from "@chainlink/contracts/src/v0.8/interfaces/LinkTokenInterface.sol";

/**

* THIS IS AN EXAMPLE CONTRACT THAT USES HARDCODED VALUES FOR CLARITY.

* THIS IS AN EXAMPLE CONTRACT THAT USES UN-AUDITED CODE.

* DO NOT USE THIS CODE IN PRODUCTION.

*/

contract CrossSourceMinter {

// Custom errors to provide more descriptive revert messages.

error NotEnoughBalance(uint256 currentBalance, uint256 calculatedFees); // Used to make sure contract has enough balance to cover the fees.

error NothingToWithdraw(); // Used when trying to withdraw but there's nothing to withdraw.

IRouterClient public router;

LinkTokenInterface public linkToken;

uint64 public destinationChainSelector;

address public owner;

address public destinationMinter;

event MessageSent(bytes32 messageId);

constructor(address destMinterAddress) {

owner = msg.sender;

//Â [https://docs.chain.link/ccip/supported-networks/testnet](https://docs.chain.link/ccip/supported-networks/testnet)

// from Fuji

address routerAddressFuji = 0xF694E193200268f9a4868e4Aa017A0118C9a8177;

router = IRouterClient(routerAddressFuji);

linkToken = LinkTokenInterface(0x0b9d5D9136855f6FEc3c0993feE6E9CE8a297846);

linkToken.approve(routerAddressFuji, type(uint256).max);

// to Sepolia

destinationChainSelector = 16015286601757825753;

destinationMinter = destMinterAddress;

}

function mintOnSepolia() external {

// Mint from Fuji network = chain[1]

Client.EVM2AnyMessage memory message = Client.EVM2AnyMessage({

receiver: abi.encode(destinationMinter),

data: abi.encodeWithSignature("mintFrom(address,uint256)", msg.sender, 1),

tokenAmounts: new Client.EVMTokenAmount[](0),

extraArgs: Client._argsToBytes(

Client.EVMExtraArgsV1({gasLimit: 980_000})

),

feeToken: address(linkToken)

});

// Get the fee required to send the message

uint256 fees = router.getFee(destinationChainSelector, message);

if (fees > linkToken.balanceOf(address(this)))

revert NotEnoughBalance(linkToken.balanceOf(address(this)), fees);

bytes32 messageId;

// Send the message through the router and store the returned message ID

messageId = router.ccipSend(destinationChainSelector, message);

emit MessageSent(messageId);

}

modifier onlyOwner() {

require(msg.sender == owner);

_;

}

function linkBalance (address account) public view returns (uint256) {

return linkToken.balanceOf(account);

}

function withdrawLINK(

address beneficiary

) public onlyOwner {

uint256 amount = linkToken.balanceOf(address(this));

if (amount == 0) revert NothingToWithdraw();

linkToken.transfer(beneficiary, amount);

}

}

// Fin

Deploy

Parameter es la direccion del CrossDestinationMinter (desde Sepolia)

- **********************************************

En Metamask

Red Avalanche Fuji

Envie 6 LINK para la direccion del CrossSourceMinter

Mira el saldo de LINK deÂ CrossSourceMinter

EnÂ Remix, CrossSourceMinter

linkBalance

Parametro: la direccion CrossSourceMinter

O resultado serÃ¡

6000000000000000000

= 6 LINK

Listo!

mintOnSepolia

[https://ccip.chain.link/](https://ccip.chain.link/)

- ***************************

Add la red Polygon Mumbai en Metamask

[https://chainlist.org/chain/80001](https://chainlist.org/chain/80001)

[https://workshop-faucet.vercel.app/faucets/mumbai](https://workshop-faucet.vercel.app/faucets/mumbai)

[https://docs.chain.link/resources/link-token-contracts/#mumbai-testnet](https://docs.chain.link/resources/link-token-contracts/#mumbai-testnet)

AÃ±adir a wallet

En Remix

Cree

CrossSourceMinterMumbai.sol

// Inicio

// SPDX-License-Identifier: MIT

pragma solidity 0.8.19;

// Deploy this contract on Mumbai

import {IRouterClient} from "@chainlink/contracts-ccip/src/v0.8/ccip/interfaces/IRouterClient.sol";

import {Client} from "@chainlink/contracts-ccip/src/v0.8/ccip/libraries/Client.sol";

import {LinkTokenInterface} from "@chainlink/contracts/src/v0.8/interfaces/LinkTokenInterface.sol";

/**

* THIS IS AN EXAMPLE CONTRACT THAT USES HARDCODED VALUES FOR CLARITY.

* THIS IS AN EXAMPLE CONTRACT THAT USES UN-AUDITED CODE.

* DO NOT USE THIS CODE IN PRODUCTION.

*/

contract CrossSourceMinterMumbai {

// Custom errors to provide more descriptive revert messages.

error NotEnoughBalance(uint256 currentBalance, uint256 calculatedFees); // Used to make sure contract has enough balance to cover the fees.

error NothingToWithdraw(); // Used when trying to withdraw but there's nothing to withdraw.

IRouterClient public router;

LinkTokenInterface public linkToken;

uint64 public destinationChainSelector;

address public owner;

address public destinationMinter;

event MessageSent(bytes32 messageId);

constructor(address destMinterAddress) {

owner = msg.sender;

//Â [https://docs.chain.link/ccip/supported-networks/testnet](https://docs.chain.link/ccip/supported-networks/testnet)

// from Mumbai

address routerAddressMumbai = 0x1035CabC275068e0F4b745A29CEDf38E13aF41b1;

router = IRouterClient(routerAddressMumbai);

linkToken = LinkTokenInterface(0x326C977E6efc84E512bB9C30f76E30c160eD06FB);

linkToken.approve(routerAddressMumbai, type(uint256).max);

// to Sepolia

destinationChainSelector = 16015286601757825753;

destinationMinter = destMinterAddress;

}

function mintOnSepolia() external {

// Mint from Mumbai network = chain[2]

Client.EVM2AnyMessage memory message = Client.EVM2AnyMessage({

receiver: abi.encode(destinationMinter),

data: abi.encodeWithSignature("mintFrom(address,uint256)", msg.sender, 2),

tokenAmounts: new Client.EVMTokenAmount[](0),

extraArgs: Client._argsToBytes(

Client.EVMExtraArgsV1({gasLimit: 980_000})

),

feeToken: address(linkToken)

});

// Get the fee required to send the message

uint256 fees = router.getFee(destinationChainSelector, message);

if (fees > linkToken.balanceOf(address(this)))

revert NotEnoughBalance(linkToken.balanceOf(address(this)), fees);

bytes32 messageId;

// Send the message through the router and store the returned message ID

messageId = router.ccipSend(destinationChainSelector, message);

emit MessageSent(messageId);

}

modifier onlyOwner() {

require(msg.sender == owner);

_;

}

function linkBalance (address account) public view returns (uint256) {

return linkToken.balanceOf(account);

}

function withdrawLINK(

address beneficiary

) public onlyOwner {

uint256 amount = linkToken.balanceOf(address(this));

if (amount == 0) revert NothingToWithdraw();

linkToken.transfer(beneficiary, amount);

}

}

// Fin

Deploy

Parametro - la direcion del CrossDestinationMinter